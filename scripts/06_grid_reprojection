# 06_grid_reprojection.R
# Grid Reprojection for Biologically Relevant Coordinate System

# PURPOSE:
# This script reprojects the prediction grid from the original Lambert Azimuthal Equal Area 
# projection to a rotated version that better aligns with the biological orientation of 
# the Antarctic Peninsula region for more meaningful spatial analysis.
# This was created in hoped to create more relaible models
# Spatial Analysis: DSM models work better when the coordinate system aligns with 
#    the biological patterns (e.g., along-shore vs. cross-shore gradients)
# Interpretation: Results are more interpretable when axes align with geographic features
#    like the peninsula's orientation

# The original grid was created using:
# - Projection: "+proj=laea +lat_0=-90 +lon_0=-57 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs"
# - Grid resolution: 5km cells

# new projection:
# - Projection: "+proj=laea +lat_0=-90 +lon_0=-105 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs"
# - Key change: Rotated longitude center from -57°W to -105°W
# - This rotation better aligns with the Antarctic Peninsula's orientation

# load in requried inputs
# - Original grid from script 04 (grid development)
# - Survey data (segs_f and obs_f) that need to be reprojected to match

p  <- "+proj=laea +lat_0=-90 +lon_0=-105 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs"
grid_rp <- grid %>% st_transform(p) 

grid_rp_points <- grid_rp

st_geometry(grid_rp) <- "poly"
grid_rp_poly <-  grid_rp %>% st_transform(p) 

# Ensure the segment and observation data are now in the reprojected format
rp  <- "+proj=laea +lat_0=-90 +lon_0=-105 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs"

segs_rp <- segs_f %>% 
  st_drop_geometry() %>% 
  st_as_sf(coords=c("LonM", "LatM"), crs = 4326) %>% 
  st_transform(rp) %>% 
  mutate(m = month(st),
         month.x = factor(m,
                          levels = c(11, 12, 1, 2, 3),
                          labels = c("1", "2", "3", "4", "5"),
                          ordered = TRUE))%>% 
  mutate(x = st_coordinates(geometry)[,"X"],
         y = st_coordinates(geometry)[,"Y"])

segs_rp$month.n <- segs_rp$month.x %>%
  as.integer()

obs_rp <- obs_f%>% 
  st_drop_geometry() %>% 
  st_as_sf(coords=c("lon", "lat"), crs = 4326) %>% 
  st_transform(rp) %>% 
  mutate(m = month(st),
         month.x = factor(m,
                          levels = c(11, 12, 1, 2, 3),
                          labels = c("1", "2", "3", "4", "5"),
                          ordered = TRUE)) %>% 
  mutate(x = st_coordinates(geometry)[,"X"],
         y = st_coordinates(geometry)[,"Y"])

save(grid_rp_points, grid_rp_poly, segs_rp, obs_rp, file = "6_re_proj_grid_segs_obs.Rdata")
